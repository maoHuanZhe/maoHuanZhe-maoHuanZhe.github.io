---
title: 什么是分析
date: 2022-04-19 20:30:41
permalink: /pages/eed042/
categories:
  - Elasticsearch
  - 分析数据
tags:
  - 
author: 
  name: 樊光瑞
  link: https://github.com/maoHuanZhe
---

分析(`analysis`)是在文档被发送并加入倒排索引之前，`Elasticsearch` 在其主体上进行的操作。在文档被加入索引之前，`Elasticsearch` 让每个被分析字段经过一系列的处理步骤。

- 字符过滤——使用字符过滤器转变字符。
- 文本切分为分词——将文本切分为单个或多个分词。
- 分词过滤——使用分词过滤器转变每个分词。
- 分词索引——将这些分词存储到索引中。

接下来将针对每步讨论更多的细节，但是先看看框架图中，总结的整个流程。图 5-1 展示了文本 `share your experience with NoSql & big data technologies` 被转变为分析后的分词：`share`、`your`、 `experience`、`with`、 `nosql`、`big`、`data`、`tools` 和 `technologies`。这里所展示的分析器是定制的，使用了字符过滤器、分词器和分词过滤器。本章稍后会更深入地讨论定制分析器。

::: center

![image](https://cdn.jsdelivr.net/gh/maoHuanZhe/image@main/20220422/image.rhk2pmyfu2.webp)

图 5-1 使用标准模块的定制分析器，其整体分析流程的概览

:::

## 字符过滤

如图 5-1 左上角所示，`Elasticsearch` 首先运行字符过滤器。这些过滤器将特定的字符序列转变为其他的字符序列。这个可以用于将 `HTML` 从文本中剥离，或者是将任意数量的字符转化为其他宇符（也许是将 `I love u 2`，这种缩写的短消息纠正为 `I love you too`）。在图 5-1中，我们使用特定的过滤器将 `＆` 替换为 `and`。

## 切分为分词

在应用了字符过滤器之后，文本需要被分割为可以操作的片段。`Lucene` 自己不会对大块的字符串数据进行操作。相反，它处理的是被称为分词(`token`)的数据。分词是从文本片段生成的，可能会产生任意数量（甚至是 0）的分词。例如，在英文中一个通用的分词是标准分词器，它根据空格、换行和破折号等其他字符，将文本分割为分词。在图 5-1 中，这种行为表现为将字符串 `share your experience with NoSql and big data technologies`
分解为分词 `share`、`your`、`experience`、 `with`, `NoSql`、`and`、 `big`、`data` 和 `technologies`。

## 分词过滤器

一旦文本块被转换为分词，`Elasticsearch` 将会对每个分词运用分词过滤器(`token filter`)。这些分词过滤器可以将一个分词作为输入，然后根据需要进行修改，添加或者是删除。最为有用的和常用的分词过滤器是小写分词过滤器，它将输入的分词变为小写，确保在搜索词条 `nosql` 的时候，可以发现关于 `NoSql` 的聚会。分词可以经过多于 1 个的分词过滤器，每个过滤器对分词进行不同的操作，将数据塑造为最佳的形式，便于之后的索引。

在图 5-1 给出的例子中,有 3 种分词过滤器：第一个将分词转为小写,第二个删除除停用词 `and` (本章稍后会讨论停用词），第三个将词条 `tools` 作为 `technologics` 的同义词进行添加。

## 分词索引

当分词经历了零个或者多个分词过滤器，它们将被发送到 `Lucene` 进行文档的索引。这些分词组成了第 1 章所讨论的倒排索引。

所有这些不同的部分，组成了一个分析器(`analyzer`)，它可以定义为零个或多个字符过滤器、一个分词器、零个或多个分词过滤器。本章稍后谈及一些预定义的分析器。你可以直接使用它们而无须构建自己的分析器。不过先来谈谈一个分析器中的单独模块。

::: tips 进行搜索时的分析
搜索在索引中执行之前，根据所使用的查询类型，分析同样可以运用到搜索的文本。需要特别注意的是，`match` 和 `match_phrase` 这样的查询，在搜索之前会执行分析步骤，而 `term` 和 `terms` 这样的查询不会。当调试为什么特定的搜索能够匹配或无法匹配某篇文档时，牢记这一点非常重要——原因可能是分析的方式和你的预期有所不同。甚至还有一个配置的选项，为被搜索的文本和被索引文本设置不同的分析器。我们讨论 N 元语法(`ngram`)分析器的时候会阐述更多细节。请查看 4.2.1 节，了解匹配和词条查询的更多细节。

:::

现在你已经理解了在 `Elasticsearch` 分析的过程中会发生什么事情。接下来讨论在你的映射中，如何设置分析器，以及如何定制分析器。
