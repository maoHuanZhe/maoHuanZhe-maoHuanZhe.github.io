---
title: 写在前面
date: 2022-04-19 20:26:07
permalink: /pages/f0cedd/
categories:
  - Elasticsearch
  - 搜索数据
tags:
  - 
author: 
  name: 樊光瑞
  link: https://github.com/maoHuanZhe
---

:

::: tips 本章主要内容

- `Elasticsearch` 搜索请求和响应的结构
- `Elasticsearch` 过滤器，以及它们和查询的区别
- 过滤器的位集合和缓存
- 使用 `Elasticsearch` 所支持的查询和过滤器

:::

目前为止，我们已经探索了如何将数据放入 `Elasticsearch`，现在来讨论下如何将数据从 `Elasticsearch` 中拿出来，那就是通过搜索。毕竟，如果不能搜索数据，那么将其放入搜索引擎的意义又何在呢？幸运的是，`Elasticsearch` 提供了丰富的接口来搜索数据，涵盖了 `Lucene` 所有的搜索功能。因为 `Elasticsearch` 允许构建搜索请求的格式很灵活，请求的构建有无限的可能性。要了解哪些查询和过滤器的组合适用于你的数据，最佳的方式就是进行实验，因此不要害怕在项目的数据上尝试这些组合，这样才能弄清哪些更适合你的需求。

::: tips 可搜索的数据

本章将再次使用聚会网站所生成的数据集，在之前的样例中我们已经接触了这些数据。为了学习样例和进行你自己的查询，下载并运行 `populate.sh` 的脚本来构造一个 `Elasticsearch` 搜索。首次运行脚本将会创建样例。如果想紧跟本书的内容，请再次运行这个脚本。

若要下载脚本，请参考本书的源代码。

:::

一开始会讨论对于所有搜索请求和结果都通用的模块，这样你就可以理解在普通情况下，搜索请求和结果看上去长什么样子。然后我们继续讨论查询和作为搜索 `API` 主要元素之一的过滤器 `DSL`。接下来讨论查询和过滤器的区别，然后是一些最常用的过滤器和查询。如果你对 `Elasticsearch` 如何计算文档得分的细节感到好奇，不要着急，第 6 章将对此进行探讨，那里都是关于搜索的相关性。最后，我们提供了一个快速而简易的指南，对于特定应用，它可以帮助你选择查询和过滤器组合的类型。如果感觉有太多类型的查询和过滤器，那么直接来看看这个指南吧。

在开始之前，先看看在执行 `Elasticsearch` 搜索的时候，都发生了些什么（见图 4-1）。`REST API` 搜索请求被发送到所连接的节点，该节点根据要查询的索引，将这个请求依次发送到所有的相关分片（主分片或者副本分片）。从所有分片收集到足够的排序和排名信息之后，只有包含所需文档的分片才被要求返回相关内容。

这种搜索路由的行为是可以配置的。图 4-1 展示了默认的行为，称为 `查询后获取`（`query_then_fetch`）。之后在第 10 章我们将介绍如何改变这个行为。现在先看看所有 `Elasticsearch` 搜索请求所共有的基本结构。

::: center

![image](https://cdn.jsdelivr.net/gh/maoHuanZhe/image@main/20220413/image.6b0j12dh6ow0.webp)

图 4-1 搜索请求是如何路由的。索引包含两个分片，每个分片有一个副本分片。在给文档定位和评分后，只会获取排名前 10 的文档

:::
